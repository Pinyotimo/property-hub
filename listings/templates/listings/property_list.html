{% extends "base.html" %}
{% load static %}
{% block title %}Available Properties{% endblock %}

{% block content %}

<!-- Page Styling -->
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(to right, #6966c1, #b9c6a1);
  }

  .btn-gradient {
    background: linear-gradient(90deg, #ff9966, #ff5e62);
    color: #fff !important;
    border-radius: 30px;
    padding: 0.6rem 1.2rem;
    font-weight: 600;
    transition: 0.3s ease-in-out;
  }

  .btn-gradient:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 10px rgba(255, 94, 98, 0.4);
  }

  .card {
    border: none;
    border-radius: 16px;
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    background: #fafafa;
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.18);
  }

  .card-img-top {
    height: 260px;
    object-fit: cover;
  }

  .property-details li {
    padding: 6px 0;
    font-size: 0.95rem;
    border-bottom: 1px solid #ddd;
  }

  .property-details li:last-child {
    border-bottom: none;
  }
</style>

<div class="container py-5">

  <!-- Title -->
  <h2 class="text-center fw-bold text-danger mb-4">
    Available Properties
  </h2>

  <!-- Role-aware button -->
  {% if request.user.is_authenticated %}
    {% if request.user.role == 'seller' or request.user.role == 'admin' %}
      <div class="text-end mb-4">
        <a href="{% url 'property_create' %}" class="btn btn-gradient">
          <i class="bi bi-plus-circle"></i> Add Property
        </a>
      </div>
    {% elif request.user.role == 'buyer' %}
      <div class="text-end mb-4">
        <a href="#properties-section" class="btn btn-outline-primary">
          <i class="bi bi-eye"></i> View Properties
        </a>
      </div>
    {% endif %}
  {% endif %}

  <!-- Property Grid -->
  <div class="row g-4" id="properties-section">
    {% for property in properties %}
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm">

          {% if property.image %}
            <img src="{{ property.image.url }}" alt="{{ property.title }}" class="card-img-top">
          {% else %}
            <img src="{% static 'images/default-property.jpg' %}" class="card-img-top" alt="Default Property Image">
          {% endif %}

          <div class="card-body d-flex flex-column">

            <!-- Title -->
            <h5 class="fw-semibold text-warning">{{ property.title }}</h5>

            <!-- Property Details -->
            <ul class="list-unstyled property-details mt-3">
              <li>üí∞ <strong>Price:</strong> 
                <span class="text-success fw-bold">KES {{ property.price|floatformat:0 }}</span>
              </li>
              <li>üìç <strong>Location:</strong> 
                <span class="text-primary">{{ property.location }}</span>
              </li>
              <li>üè† <strong>Type:</strong>
                <span class="badge bg-warning text-dark">
                  {{ property.get_property_type_display }}
                </span>
              </li>
              <li>
                {% if property.status == "available" %}
                  ‚úÖ <strong>Status:</strong>
                  <span class="badge bg-success px-3">Available</span>
                {% else %}
                  ‚ùå <strong>Status:</strong>
                  <span class="badge bg-secondary px-3">Unavailable</span>
                {% endif %}
              </li>
            </ul>

            <!-- Buttons -->
            <div class="mt-auto">
              <a href="{% url 'property_detail' property.pk %}" class="btn btn-gradient w-100 mb-2">
                View Details
              </a>

              {% if request.user.is_authenticated %}
                {% if request.user == property.owner %}
                  <a href="{% url 'property_update' property.pk %}" class="btn btn-outline-warning w-100 mb-2">
                    Edit
                  </a>
                {% endif %}
                {% if request.user == property.owner or request.user.is_superuser or request.user.is_staff %}
                  <a href="{% url 'property_delete' property.pk %}" 
                     class="btn btn-outline-danger w-100"
                     onclick="return confirm('Are you sure you want to delete this property?');">
                    Delete
                  </a>
                {% endif %}
              {% endif %}

            </div>

          </div>
        </div>
      </div>

    {% empty %}
      <div class="col-12 text-center py-5">
        <i class="bi bi-house text-muted fs-1"></i>
        <p class="text-muted mt-2">No properties available at the moment.</p>
      </div>
    {% endfor %}
  </div>
</div>

{% endblock %}
